# // frontend/Dockerfile

# Stage 1: Build
FROM node:20-alpine AS builder
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npx nuxi build

# Stage 2: Run
FROM node:20-alpine
WORKDIR /app
ENV NODE_ENV=production

# Nuxt output is in the .output folder
COPY --from=builder /app/.output ./.output

USER node
EXPOSE 3000
# Nitro server entry point
CMD ["node", ".output/server/index.mjs"]
/////////////////////
 frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile.dev
    # Volume mounts for hot-reload in development
    volumes:
      - ./frontend:/app
      - /app/node_modules
      - /app/.nuxt
      - /app/.output
    ports:
      - "3000:3000"
    environment:
      - NUXT_PUBLIC_API_BASE_SSR=http://backend:4000
      - NUXT_PUBLIC_API_BASE_CLIENT=http://localhost:4000
      - CHOKIDAR_USEPOLLING=true
      - NODE_ENV=development
    networks:
      - public_net
    depends_on:
      - backend
